using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using Divuvina.Business;

namespace Divuvina.Controllers
{
    public class QuanLyNhanVienController : Controller
    {
        Models.dbContext _db = new Models.dbContext();
        // GET: QuanLyNhanVien

        public ActionResult Index()
        {
            return View();
        }
        public ActionResult DanhMucLoaiHopDong()
        {
            return View();
        }
        public JsonResult GetDataDanhMucLoaiHopDong()
        {
            var rs = _db.LoaiHopDongs.Select(r=>new { Key = r.LoaiHopDongKey, r.Ten, r.DienGiai, r.GhiChu });
            return Json(rs, JsonRequestBehavior.AllowGet);
            //return Json(new { employee = rs }, JsonRequestBehavior.AllowGet);
        }
        [HttpPost]
        public JsonResult DeleteDanhMucLoaiHopDong(int Key)
        {
            try
            {                
                var row = _db.LoaiHopDongs.FirstOrDefault(r => r.LoaiHopDongKey == Key);
                if (row != null)
                {
                    _db.LoaiHopDongs.Remove(row);
                    _db.SaveChanges();
                }

                return Json(new { Result = true, Title = "Thông báo !", Message = "Thao tác dữ liệu thành công !" }, JsonRequestBehavior.AllowGet);
            }
            catch (Exception)
            {
                return Json(new { Result = false, Title = "Thông báo !", Message = "Thao tác dữ liệu không thành công !" }, JsonRequestBehavior.AllowGet);
            }
        }

        [HttpPost]
        public ActionResult SaveDanhMucLoaiHopDong(int Key, string Ten, string DienGiai, string GhiChu)
        {
            try
            {
                var row = _db.LoaiHopDongs.FirstOrDefault(r => r.LoaiHopDongKey == Key);
                if (row == null)
                {
                    row = new Models.LoaiHopDong();
                    row.LoaiHopDongAlternateKey = Key.ToString();
                    _db.LoaiHopDongs.Add(row);
                }
                row.Ten = Ten;
                row.DienGiai = DienGiai;
                row.GhiChu = GhiChu;
                
                _db.SaveChanges();

                return Json(new { Result = true, Title = "Thông báo !", Message = "Thao tác dữ liệu thành công !" }, JsonRequestBehavior.AllowGet);
            }
            catch (Exception ex)
            {
                return Json(new { Result = false, Title = "Thông báo !", Message = "Thao tác dữ liệu không thành công !" }, JsonRequestBehavior.AllowGet);
            }
        }
    }
}
