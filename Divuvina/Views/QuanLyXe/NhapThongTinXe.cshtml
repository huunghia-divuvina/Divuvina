@using Divuvina.Models.QuanLyXe
@model ThongTinXeVaKhauHaoModel
@*@{
    ViewBag.Title = "NhapThongTinXe";
}*@



<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Thông tin xe</h2>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <form class="form-horizontal m-t-md" id="formThongTinXe" role="form" autocomplete="off">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title"><h3>Phần thông tin xe</h3></div>
                    <div class="ibox-content">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Hãng sản xuất xe:</label>
                            <div class="col-md-4">
                                <input type="hidden" id="KeyHangSanXuatXe" name="KeyHangSanXuatXe" />
                                <select class="form-control" id="HangSanXuatXeKey"></select>
                                <span />
                            </div>
                            <label class="col-sm-2 control-label">Loại xe:</label>
                            <div class="col-md-4">
                                <input type="hidden" id="KeyLoaiXe" name="KeyLoaiXe" />
                                <select class="form-control" id="LoaiXeKey"></select>
                                <span />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">Bảng số xe:</label>
                            <div class="col-md-4">
                                <input type="text" id="BangSoXe" name="BangSoXe" value="@Model.BangSoXe" class="form-control" placeholder="Nhập bảng số xe">
                                <span />
                            </div>
                            <label class="col-sm-2 control-label">Số sàn:</label>
                            <div class="col-md-4">
                                <input type="text" id="SoSan" name="SoSan" value="@Model.SoSan" class="form-control" placeholder="Nhập số sàn">
                                <span />
                            </div>
                        </div>

                        <div class="form-group" id="divNgayCapPhep">
                            <label class="col-sm-2 control-label">Màu:</label>
                            <div class="col-md-4">
                                <input type="text" id="Mau" name="Mau" value="@Model.Mau" class="form-control" placeholder="Nhập màu xe">
                                <span />
                            </div>
                            <label class="col-sm-2 control-label">Ngày cấp phép:</label>
                            <div class="col-md-4">
                                <div class="input-group date">
                                    <span class="input-group-addon">
                                        <i class="fa fa-calendar"></i>
                                    </span>
                                    <input type="text" id="NgayCapPhep" name="NgayCapPhep" value="@Model.NgayCapPhep.ToString("dd-MM-yyyy")" class="form-control">
                                    <span />
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label"></label>
                            <div class="col-md-3">
                                <div class="checkbox checkbox-primary checkbox-inline">
                                    <input type="checkbox" id="CoWifi" name="CoWifi" checked="@Model.CoWifi" class="form-control">
                                    <label for="CoWifi"><b>Có Wifi</b></label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="checkbox checkbox-success checkbox-inline">
                                    <input type="checkbox" id="CoTivi" name="CoTivi" checked="@Model.CoTivi" class="form-control">
                                    <label for="CoTivi"><b>Có Tivi</b></label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="checkbox checkbox-info checkbox-inline">
                                    <input type="checkbox" id="CoCameraHanhTrinh" name="CoCameraHanhTrinh" checked="@Model.CoCameraHanhTrinh" class="form-control">
                                    <label for="CoCameraHanhTrinh"><b>Có camera hành trình</b></label>
                                    <span />
                                </div>
                            </div>
                            <label class="col-sm-1 control-label"></label>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">Ghi chú thông tin xe:</label>
                            <div class="col-md-10">
                                <input type="text" id="GhiChuThongTinXe" name="GhiChuThongTinXe" value="@Model.GhiChuThongTinXe" class="form-control" placeholder="Nhập thông tin ghi chú về xe">
                                <span />
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title"><h3>Thông tin chi phí mua xe và khấu hao</h3></div>
                    <div class="ibox-content">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Giá mua:</label>
                            <div class="col-md-4">
                                <input class="touchspin3" id="GiaMua" name="GiaMua" value="@Model.GiaMua" type="text">
                                <span />
                            </div>

                            <label class="col-sm-2 control-label">Tổng tiền khấu hao:</label>
                            <div class="col-md-4">
                                <input class="touchspin3" id="TongTienKhauHao" name="TongTienKhauHao" value="@Model.TongTienKhauHao" type="text">
                                <span />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">Số tháng khấu hao:</label>
                            <div class="col-md-4">
                                <input class="touchspin3" id="SoThangKhauHao" name="SoThangKhauHao" value="@Model.SoThangKhauHao" type="text">
                                <span />
                            </div>

                            <label class="col-sm-2 control-label">Tiền khấu hao hàng tháng:</label>
                            <div class="col-md-4">
                                <input class="touchspin3" id="TienKhauHaoHangThang" name="TienKhauHaoHangThang" value="@Model.TienKhauHaoHangThang" type="text">
                                <span />
                            </div>
                        </div>

                        <div class="form-group" id="divNgayKhauHao">
                            <label class="col-sm-2 control-label">Ngày bắt đầu khấu hao:</label>
                            <div class="col-md-4">
                                <div class="input-group date">
                                    <span class="input-group-addon">
                                        <i class="fa fa-calendar"></i>
                                    </span>
                                    <input type="text" id="NgayBatDauKhauHao" name="NgayBatDauKhauHao" value="@Model.NgayBatDauKhauHao.ToString("dd-MM-yyyy")" class="form-control">
                                    <span />
                                </div>
                            </div>

                            <label class="col-sm-2 control-label">Ngày kết thúc khấu hao:</label>
                            <div class="col-md-4">
                                <div class="input-group date">
                                    <span class="input-group-addon">
                                        <i class="fa fa-calendar"></i>
                                    </span>
                                    <input type="text" id="NgayKetThucKhauHao" name="NgayKetThucKhauHao" value="@Model.NgayKetThucKhauHao.ToString("dd-MM-yyyy")" class="form-control">
                                    <span />
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">Ghi chú khấu hao:</label>
                            <div class="col-md-10">
                                <input type="text" id="GhiChuKhauHaoXe" name="GhiChuKhauHaoXe" value="@Model.GhiChuKhauHaoXe" class="form-control" placeholder="Nhập thông tin ghi chú khấu hao xe">
                                <span />
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-sm-2 col-md-offset-2">
                                <button type="button" class="btn btn-w-m btn-success" id="btNew"><i class="fa fa-file" aria-hidden="true"></i> Tạo mới</button>
                                <span />
                            </div>

                            <div class="col-sm-2">
                                <button type="button" class="btn btn-w-m btn-success" id="btSave"><i class="fa fa-floppy-o" aria-hidden="true"></i> Lưu</button>
                                <span />
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title"><h3>Danh sách xe và khấu hao</h3></div>
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table id="tableThongTinXe" class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th width="50" align="center" valign="middle">Thứ tự</th>
                                        <th>Bảng số xe</th>
                                        <th>Số sàn</th>
                                        <th>Loại xe</th>
                                        <th>Hãng sản xuất</th>
                                        <th>Ngày cấp phép</th>
                                        <th>Màu</th>
                                        <th>Hãng sản xuất</th>
                                        <th>Bảng số xe</th>
                                        <th>Tổng giá</th>
                                        <th>Tổng tiền khấu hao</th>
                                        <th>Số tháng khấu hao</th>
                                        <th>Tiền khấu hao hàng tháng</th>
                                        <th>Ngày bắt đầu khấu hao</th>
                                        <th>Ngày kết thúc khấu hao</th>
                                        <th>Có Wifi</th>
                                        <th>Có Tivi</th>
                                        <th>Có Camera hành trình</th>
                                        <th>Ghi chú xe</th>
                                        <th>Ghi chú khấu hao</th>
                                        <th width="50">Sửa</th>
                                        <th width="50">Xóa</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <input type="hidden" id="XeKey" name="XeKey" value="@Model.XeKey" />
    </form>
        
</div>

@section Styles {
    @Styles.Render("~/plugins/awesomeCheckboxStyles")
    @Styles.Render("~/plugins/clockpickerStyles")
    @Styles.Render("~/plugins/dateRangeStyles")
    @Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
    @Styles.Render("~/Content/plugins/chosen/chosenStyles")
    @Styles.Render("~/plugins/switcheryStyles")
    @Styles.Render("~/plugins/jasnyBootstrapStyles")
    @Styles.Render("~/plugins/nouiSliderStyles")
    @Styles.Render("~/plugins/dataPickerStyles")
    @Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
    @Styles.Render("~/plugins/imagecropperStyles")
    @Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
    @Styles.Render("~/plugins/select2Styles")
    @Styles.Render("~/plugins/touchSpinStyles")
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    @Styles.Render("~/plugins/toastrStyles")
    @Styles.Render("~/plugins/sweetAlertStyles")

    <link href="~/Content/Divuvina/DivuvinaTable.css" rel="stylesheet" />

@Styles.Render("~/plugins/awesomeCheckboxStyles")
@Styles.Render("~/plugins/clockpickerStyles")
@Styles.Render("~/plugins/dateRangeStyles")
@Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
@Styles.Render("~/Content/plugins/chosen/chosenStyles")
@Styles.Render("~/plugins/switcheryStyles")
@Styles.Render("~/plugins/jasnyBootstrapStyles")
@Styles.Render("~/plugins/nouiSliderStyles")
@Styles.Render("~/plugins/dataPickerStyles")
@Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
@Styles.Render("~/plugins/imagecropperStyles")
@Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
@Styles.Render("~/plugins/select2Styles")
@Styles.Render("~/plugins/touchSpinStyles")
}

@section Scripts {
    @Scripts.Render("~/plugins/iCheck")
    @Scripts.Render("~/plugins/dataPicker")
    @Scripts.Render("~/plugins/ionRange")
    @Scripts.Render("~/plugins/nouiSlider")
    @Scripts.Render("~/plugins/jasnyBootstrap")
    @Scripts.Render("~/plugins/switchery")
    @Scripts.Render("~/plugins/chosen")
    @Scripts.Render("~/plugins/knob")
    @Scripts.Render("~/plugins/imagecropper")
    @Scripts.Render("~/plugins/colorpicker")
    @Scripts.Render("~/plugins/clockpicker")
    @Scripts.Render("~/plugins/dateRange")
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/touchSpin")
    @Scripts.Render("~/plugins/jeditable")
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/toastr")
    @Scripts.Render("~/plugins/sweetAlert")
    @Scripts.Render("~/plugins/fullcalendar")

    @Scripts.Render("~/plugins/iCheck")
    @Scripts.Render("~/plugins/dataPicker")
    @Scripts.Render("~/plugins/ionRange")
    @Scripts.Render("~/plugins/nouiSlider")
    @Scripts.Render("~/plugins/jasnyBootstrap")
    @Scripts.Render("~/plugins/switchery")
    @Scripts.Render("~/plugins/chosen")
    @Scripts.Render("~/plugins/knob")
    @Scripts.Render("~/plugins/imagecropper")
    @Scripts.Render("~/plugins/colorpicker")
    @Scripts.Render("~/plugins/clockpicker")
    @Scripts.Render("~/plugins/dateRange")
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/touchSpin")

    @Scripts.Render("~/Scripts/Public/ShowMessage.js")
    @Scripts.Render("~/Scripts/Public/SettingControls.js")
    @Scripts.Render("~/Scripts/QuanLyXe/ThongTinXe.js")

    <script type="text/javascript">
        $(document).ready(function () {

            //===================================================
            var coWifi = true;
            if (String("@(Model.CoWifi)") == "False") { coWifi = false };
            var coTivi = true;
            if (String("@(Model.CoTivi)") == "False") { coTivi = false };
            var coCameraHanhTrinh = true;
            if (String("@(Model.CoCameraHanhTrinh)") == "False") { coCameraHanhTrinh = false };
            $('#CoWifi').val(coWifi);
            $('#CoTivi').val(coTivi);
            $('#CoCameraHanhTrinh').val(coCameraHanhTrinh);
            //===================================================
            //Load dữ liệu Danh Mục Loai Ghế
            $.ajax({
                type: "POST",
                url: '@Url.Action("LayHangSanXuatXeChoSelect", "QuanLyXe")',
                contentType: "application/json; charset=utf-8",
                dataType: "JSON",
                success: function (response) {
                    $("#HangSanXuatXeKey").select2({
                        data: response
                        , placeholder: "Chọn hãng sản xuất xe"
                        , allowClear: true
                    });
                    $("#HangSanXuatXeKey").val(null).trigger("change");
                },
                failure: function (msg) {
                }
            });//EndLoadDataForLoaiGheSelector

            $('#HangSanXuatXeKey').change(function () {
                var id = $(this).val();
                //Load dữ liệu Danh mục loai xe
                if (id != null) {
                    var url = '@Url.Action("LayLoaiXeChoSelect", "QuanLyXe")';
                    $.getJSON(url, { hangSanXuatXeKey: id }, function (data) {
                        $('#LoaiXeKey').empty();
                        $("#LoaiXeKey").select2({
                            data: data
                        , placeholder: "Chọn loại xe"
                        , allowClear: true
                        });
                        $("#LoaiXeKey").val(null).trigger("change");
                    });
                }
            });
            $('#CoWifi').change(function () {
                $('#CoWifi').val(this.checked);
            });
            $('#CoTivi').change(function () {
                $('#CoTivi').val(this.checked);
            });
            $('#CoCameraHanhTrinh').change(function () {
                $('#CoCameraHanhTrinh').val(this.checked);
            });
            //===================================================
            SettingDatepicker('divNgayCapPhep');
            SettingDatepicker('divNgayKhauHao');

            $(".touchspin3").TouchSpin({
                verticalbuttons: true,
                verticalupclass: 'glyphicon glyphicon-plus',
                verticaldownclass: 'glyphicon glyphicon-minus'
            });
            //===================================================
            $('#GiaMua').change(function () {
                $('#TongTienKhauHao').val($('#GiaMua').val());

                var soThangKhauHao = $('#SoThangKhauHao').val();
                var tongTienKhauHao = $('#TongTienKhauHao').val();
                if (soThangKhauHao > 0) {
                    $('#TienKhauHaoHangThang').val((tongTienKhauHao / soThangKhauHao).toFixed(2));
                }
            });
            $('#SoThangKhauHao').change(function () {
                var soThangKhauHao = $('#SoThangKhauHao').val();
                var tongTienKhauHao = $('#TongTienKhauHao').val();
                if (soThangKhauHao > 0)
                {
                    $('#TienKhauHaoHangThang').val((tongTienKhauHao / soThangKhauHao).toFixed(2));
                    var ngayBatDauKhauHao = new Date($('#NgayBatDauKhauHao').val());
                    //var ngayKetThucKhauHao = new Date(ngayBatDauKhauHao.setMonth(soThangKhauHao));
                    $('#NgayKetThucKhauHao').val((new Date(ngayBatDauKhauHao.setMonth(soThangKhauHao))).toString("DD-MM-YYYY"));
                }
            });
            //===================================================

        //    $("input[type='number']").({
        //        -moz-appearance: textfield;
        //});
        //    input[type="number"]:hover,
        //    input[type="number"]:focus {
        //        -moz-appearance: number-input;
            //    }

            @*var table = $('#tableThongTinXe').DataTable({
                ajax: {
                    url: '@Url.Action("LayDanhMucLoaiXe", "QuanLyXe")'
                    , dataSrc: ''
                }
                , columns: [
                    {
                        data: null,
                        searchable: false
                        , orderable: false
                        , targets: 0
                    },
                    { data: 'Key', visible: false },
                    { data: 'Ten' },
                    { data: 'MoTa' },
                    { data: 'HangSanXuatXe' },
                    { data: 'Model' },
                    { data: 'MayChayDau' },
                    { data: 'MayChayXang' },
                    { data: 'SoGhe' },
                    { data: 'LoaiGhe' },
                    { data: 'GhiChu' },
                    {
                        data: null,
                        defaultContent: '<a class="edit"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Sửa</a>',
                        orderable: false
                    }
                    , {
                        data: null,
                        defaultContent: '<a class="delete"><i class="fa fa-trash" aria-hidden="true"></i> Xóa</a>',
                        orderable: false
                    }
                ]
                , order: [1, 'asc']
                , language: {
                    lengthMenu: 'Hiển thị _MENU_ dòng mỗi trang'
                    , info: 'Hiển thị dòng _START_ đến dòng _END_ trên tổng số _TOTAL_ dòng'
                    , infoEmpty: 'Hiển thị dòng _START_ đến dòng _END_ trên tổng số _TOTAL_ dòng'
                    , search: 'Tìm kiếm'
                    , paginate: {
                        first: "Trang đầu",
                        last: "Trang cuối",
                        next: "Sau",
                        previous: "Trước"
                    }
                }
            });*@

            @*table.on('order.dt search.dt', function () {
                table.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                    cell.innerHTML = i + 1;
                });
            }).draw();

            $('#tableThongTinXe tbody').on('click', 'tr', function () {
                if ($(this).hasClass('selected')) {
                    $(this).removeClass('selected');
                }
                else {
                    table.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                }
            });

            $('#tableThongTinXe').on('click', 'a.edit', function (e) {
                var row = $('#tableThongTinXe').DataTable().data()[$('#tableThongTinXe').DataTable().row('.selected')[0][0]];
                $('#Key').val(row.Key);
                $('#Ten').val(row.Ten);
                $('#MoTa').val(row.MoTa);
                $('#HangSanXuatXeKey').val(row.HangSanXuatXeKey).change();
                $('#Model').val(row.Model);
                $('#MayChayDau').prop('checked', row.MayChayDau);
                $('#MayChayXang').prop('checked', row.MayChayXang);
                $('#SoGhe').val(row.SoGhe);
                $('#LoaiGheKey').val(row.LoaiGheKey).change();
                $('#GhiChu').val(row.GhiChu);
            });//EndFunction

            $('#tableThongTinXe').on('click', 'a.delete', function (e) {
                var row = $('#tableThongTinXe').DataTable().data()[$('#tableThongTinXe').DataTable().row('.selected')[0][0]];
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("XoaThongTinXe", "QuanLyXe")',
                    data: "{ \"Key\" : \"" + row.Key + "\" }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        $('#dtSource').DataTable().ajax.reload();
                        onNewClick();

                        ShowMessage(response);
                    },
                    failure: function (msg) {
                        $('#output').text(msg);
                    }
                });
            });//EndFunction*@
        })//EndFunction-DocumentReady

    </script>

}


